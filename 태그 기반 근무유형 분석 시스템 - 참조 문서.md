
## (24시간 CMO 제약회사용)

### 회사 특성

- **24시간 생산 체계**: 생산직 2교대 근무
    - 주간조: 08:00-20:30
    - 야간조: 20:00-08:30
- **4회 식사 제공**:
    - 조식: 06:30-09:00
    - 중식: 11:20-13:20
    - 석식: 17:00-20:00
    - 야식: 23:30-01:00
- **근무 형태**:
    - 생산직: 2교대 (30분 인수인계 중복)
    - 사무직: 자율근무제, 탄력근무제
- **특수 패턴**: 교대 시간 30분 중복으로 인수인계 진행

## 1. 태그 정의 (12개)

|태그 코드|설명|주요 특징|
|---|---|---|
|**G1**|주업무 수행하는 공간|타 유형으로 분류되지 않는 모든 대강 지점|
|**G2**|작업 전 준비 수행 공간|락커, locker, 가우닝, gowning, 탈의, 경의, 파우더|
|**G3**|회의 등 협업이 주로 이루어지는 공식 공간|회의, meeting|
|**G4**|정기/비정기 교육이 이루어지는 공간|교육, 강의, 감성, univ|
|**N1**|휴식, 외부 등이 주로 이루어지는 공간|휴게, 모성, 대기, 수면, 탐배|
|**N2**|키워드 명령한 복지시설 또는 편의시설|메디컬, 약국, 휘트니스, 마용실, 세탁소, 나눔|
|**T1**|공간 간 연결을 위한 복도/계단 등|복도, 브릿지, 계단, 연결통로, 입장(근무영역), 출입(비근무영역)|
|**T2**|1선공간(출퇴근지점)|1선으로 지정된 태선 지점 입문|
|**T3**|1선공간(출퇴근지점)|1선으로 지정된 태선 지점 출문|
|**M1**|바이오플라자 내 식사|별도 빌딩 내 식당에서 식사|
|**M2**|바이오플라자 테이크아웃|별도 빌딩에서 음식 구매 (테이크아웃)|
|**O**|실제 업무 수행 로그|기계조작, 컴퓨터 사용 등 실제 업무 활동 로그|

## 2. 상태 정의 (11개)

|상태|설명|주요 판단 기준|
|---|---|---|
|**업무**|실제 업무 수행 상태|O 태그 존재 시 확실, G1에서 장시간 체류|
|**준비**|업무 준비 또는 정리 상태|G2 태그, 출근 직후 또는 퇴근 직전|
|**회의**|회의 및 협업 상태|G3 태그, 연속 체류 시 확률 증가|
|**교육**|교육 참석 상태|G4 태그, 장시간 체류 시 확률 증가|
|**휴게**|휴식 상태 (식사 제외)|N1, N2 태그, 짧은 시간|
|**식사**|식사 상태|M1 태그 (바이오플라자 내 식사)|
|**경유**|단순 이동/통과|T1 태그, 짧은 체류 시간|
|**출입(IN)**|출근/입실|T2, T3에서 시작하는 전환|
|**출입(OUT)**|퇴근/퇴실|T2, T3로 끝나는 전환|
|**비업무**|외출 및 기타 활동|N1 장시간, 꼬리물기 의심 케이스|

## 3. O 태그의 특별한 역할

### 3.1 업무 상태 확정

- **O → O**: 98% 확률로 업무 (가장 확실한 업무 상태)
- **G1 → O**: 98% 확률로 업무 시작
- **O → G1**: 95% 확률로 업무 지속

### 3.2 모호성 해결

- **G1 → G1** (O 태그 없음):
    - <30분: 85% 업무 (불확실)
    - > 2시간: 65% 업무 (매우 불확실)
        
- **G1 → O → G1**: 98% 업무 (확실)

### 3.3 꼬리물기 감지 개선

- **T2 → [2시간 공백] → G1**: 90% 꼬리물기 의심
- **T2 → [2시간 공백] → O**: 50% 꼬리물기 (실제 업무 가능성)
- **T1 → T1 (장시간)**:
    - 30분-2시간: 60% 업무 (꼬리물기 가능)
    - 2시간 이상: 85% 업무 (꼬리물기 확실)
    - 복도/계단에서 다른 사람 태그로 문이 열려 진입
- **패턴 특징**: T1에서 장시간 공백 후 T1은 중간에 다른 공간 진입을 의미

## 4. 주요 패턴 정의

### 4.1 출퇴근 패턴

|패턴|상태 시퀀스|시간대|설명|
|---|---|---|---|
|주간조 출근|T2 → G2 → G1/O|07:30-08:30|출입(IN) → 준비 → 업무|
|야간조 출근|T2 → G2 → G1/O|19:30-20:30|출입(IN) → 준비 → 업무|
|주간조 퇴근|G1/O → G3 → G2 → T2|20:00-21:00|업무 → 회의(인수인계) → 준비 → 출입(OUT)|
|야간조 퇴근|G1/O → G3 → G2 → T2|08:00-09:00|업무 → 회의(인수인계) → 준비 → 출입(OUT)|
|사무직 출퇴근|유동적|자율|자율/탄력근무제 적용|

#### 4.1.1 근무유형별 출퇴근 판별 로직

**일반 근무자 (주간조/사무직)**
- 출근: 05:00-10:00 시간대의 정문/스피드게이트 입문
- 퇴근: 17:00-22:00 시간대의 정문/스피드게이트 출문

**야간 근무자 (야간조)**
- 출근: 17:00-22:00 시간대의 정문/스피드게이트 입문
- 퇴근: 05:00-10:00 시간대의 정문/스피드게이트 출문
- 야간 근무자는 첫 태그 시간(18시 이후 또는 6시 이전)으로 자동 판별

**날짜 기준**
- 야간 근무자의 경우 선택한 날짜는 "퇴근하는 날짜" 기준
- 예: 6월 2일 선택 시 → 6월 1일 저녁 출근 ~ 6월 2일 아침 퇴근 데이터 표시

### 4.2 식사 패턴 (4회 제공)

|패턴|상태 시퀀스|시간대|주요 이용자|
|---|---|---|---|
|조식|T1 → M1 → T1 → G1/O|06:30-09:00|야간조(근무중), 주간조(출근후)|
|중식|G1/O → T1 → M1 → T1 → G1/O|11:20-13:20|전 직원|
|석식|G1/O → T1 → M1 → T1 → G1/O|17:00-20:00|주간조(퇴근전), 야간조(출근후)|
|야식|G1/O → T1 → M1 → T1 → G1/O|23:30-01:00|야간조|
|테이크아웃|T1 → M2 → T1 → N2|모든 시간|모든 직원|

### 4.3 이상 패턴

|패턴|판단 기준|상태 추정|조치|
|---|---|---|---|
|T2 꼬리물기|T2 → T2 (>2시간) + O 태그 없음|90% 업무(비정상)|출입 기록 확인|
|T1 꼬리물기|T1 → T1 (>30분)|60-85% 업무|이동 경로 확인|
|장시간 외출|N1 → N1 (>2시간)|비업무 확정|외출 신청 확인|
|업무 미수행|하루 중 O 태그 없음|업무 불확실|실제 업무 확인 필요|
|태그 누락|긴 시간 간격 + 위치 변경|맥락 추정|중간 경로 추정|

## 5. 시간 기반 확률 조정

### 5.1 시간 간격별 기본 설정

- **<5분**: 경유/재출입 가능성 높음
- **5-30분**: 정상적인 활동 전환
- **30분-2시간**: 식사, 회의, 교육 등
- **>2시간**: 장시간 활동, 이상 패턴 가능성

### 5.2 시간대별 가중치

- **06:30-09:00**:
    - 야간조 퇴근 준비 및 퇴근: 출입(OUT) 확률 증가
    - 주간조 출근: 출입(IN), 준비 확률 증가
    - 조식 시간: 식사 확률 증가
- **08:00-08:30**: 교대 인수인계 시간
    - 회의(인수인계) 확률 증가
    - G1, G3에서 동시 태그 발생 가능
- **11:20-13:20**: 중식 시간, 식사 확률 증가
- **17:00-20:00**:
    - 석식 시간: 식사 확률 증가
    - 사무직 퇴근: 출입(OUT) 확률 증가
- **20:00-20:30**: 교대 인수인계 시간
    - 주간조 퇴근: 출입(OUT) 확률 증가
    - 야간조 출근: 출입(IN), 준비 확률 증가
    - 회의(인수인계) 확률 증가
- **23:30-01:00**: 야식 시간, 야간조 식사 확률 증가
- **심야 시간(01:00-06:00)**: O 태그 중요도 증가 (야간 근무 확인)

## 6. 전환 확률 매트릭스 (주요 사례)

### 6.1 O 태그 관련 (가장 명확)

|From → To|상태|확률|비고|
|---|---|---|---|
|O → O|업무|98%|연속 업무 수행|
|O → M1|식사|100%|업무 중 바이오플라자 식사|
|O → M2|경유|100%|업무 중 테이크아웃 구매|
|O → T2|출입(OUT)|90%|업무 후 퇴근|
|G1 → O|업무|98%|업무 시작 확정|
|M1 → O|업무|90%|식사 후 업무 복귀|

### 6.3 M1, M2 태그 관련 (100% 확실)

|From → To|상태|확률|비고|
|---|---|---|---|
|T1 → M1|식사|100%|바이오플라자 식당 도착|
|T1 → M2|경유|100%|바이오플라자에서 구매 (짧은 체류)|
|M1 → T1|식사 완료|100%|식사 후 이동|
|M2 → T1|경유|100%|구매 후 이동|
|M1 → M2|경유|100%|식사 후 테이크아웃 구매|
|M2 → N2|휴게|높음|구매 후 휴게실에서 식사 예상|

**참고**:

- M1: 바이오플라자 내 식당에서 식사 = "식사" 상태
- M2: 바이오플라자에서 테이크아웃 구매 = "경유" 상태 (짧은 구매 행위)
- 실제 테이크아웃 식사는 N2(휴게실) 등에서 이루어지므로 "휴게" 상태로 분류

## 7. 구현 시 고려사항

### 7.1 데이터 수집

- 태그 데이터: 시간, 사용자ID, 태그코드
- O 태그: PC 로그인/아웃, 기계 조작 로그, 시스템 사용 로그
- 시간 간격: 이전 태그와의 시간차 계산

### 7.2 확률 에디터 기능

- 전환 확률 실시간 수정
- 시간대별 가중치 조정
- 부서/직급별 커스터마이징
- A/B 테스트를 통한 최적화

### 7.3 검증 메트릭

- O 태그 있는 날 vs 없는 날 정확도 비교
- 꼬리물기 감지 정확도
- 식사 패턴 분류 정확도
- 전체 상태 분류 정확도

## 8. 예외 처리

### 8.1 특수 상황

- **2교대 근무**:
    - 주간조: 08:00-20:30
    - 야간조: 20:00-08:30
    - 인수인계: 08:00-08:30, 20:00-20:30 (30분 중복)
- **야간 근무 패턴**:
    - 20:00 출근 → 23:30 야식 → 06:30 조식 → 08:30 퇴근
    - 심야 시간 O 태그로 실제 근무 확인
- **교대 시간 특징**:
    - 30분 중복 시간에 G3(회의) 태그 증가
    - 동일 시간대 양 교대 근무자 태그 발생
- **자율/탄력 근무**:
    - 사무직의 경우 출퇴근 시간 유동적
    - 코어타임 설정 시 해당 시간 가중치 조정
- **주말/공휴일**:
    - 생산직은 정상 2교대 근무
    - 사무직은 선택적 근무

#### 8.1.1 야간 근무자 데이터 처리

- **데이터 범위**: 
    - 전날 17:00 ~ 당일 12:00까지의 데이터만 로드
    - 당일 저녁(20:00 이후) 데이터는 제외 (다음날 근무 시작)
- **장비 데이터**: 
    - LAMS, MES, EAM 등 장비 사용 데이터도 동일한 시간 필터링 적용
    - O 태그로 변환하여 타임라인에 통합 표시
- **식사 데이터**: 
    - 야간 근무 시간대의 식사만 표시 (야식, 조식)
    - 동일한 17:00-12:00 필터링 적용

### 8.2 데이터 품질

- 태그 누락: 전후 맥락으로 추정
- 중복 태그: 짧은 시간 내 중복 제거
- O 태그 과다: 시스템 자동 로그 필터링

## 9. 향후 확장 가능성

### 9.1 추가 태그

- P: 개인 디바이스 사용 (스마트폰 등)
- V: 화상회의
- R: 원격 근무

### 9.2 고급 분석

- 팀 단위 협업 패턴
- 생산성과 근무 패턴 상관관계
- 번아웃 위험 조기 감지

## 11. 비업무 구간 추정 방법

### 11.1 직접적 비업무 패턴

|패턴|판단 기준|확실도|설명|
|---|---|---|---|
|N1 장시간 체류|N1 → N1 (>2시간)|90%|휴게공간 장시간 체류|
|외출 패턴|G1 → T1 → T2 → [장시간] → T2 → T1 → G1|95%|명확한 외출|
|장시간 태그 없음|마지막 태그 후 >3시간|80%|비정상적 공백|
|근무시간 중 M1 반복|M1 → [<1시간] → M1|70%|짧은 간격 식사 반복|

### 11.2 간접적 비업무 추정

|지표|계산 방법|의미|
|---|---|---|
|O 태그 비율|(O 태그 시간 / 전체 근무시간) × 100|실제 업무 비율|
|이동 과다|T1 태그 빈도 > 평균×2|불필요한 이동|
|휴게 빈도|N1, N2 방문 횟수 > 평균×1.5|과도한 휴식|
|업무 연속성|최대 연속 O 태그 시간 < 1시간|집중도 부족|

### 11.3 시간대별 비업무 패턴

|시간대|비업무 신호|정상 범위|
|---|---|---|
|오전 (09:00-11:00)|O 태그 없음 + N1/N2 빈번|O 태그 50% 이상|
|오후 (14:00-17:00)|G1 → G1 (>1시간, O 없음)|O 태그 40% 이상|
|식사 직후|M1 → N1/N2 (>30분)|15분 이내 휴식|
|교대 시간 외|비근무 시간 태그 발생|승인된 연장근무|

### 11.4 비업무 점수 산정 (예시)

```
일일 비업무 점수 = 
  (1 - O태그비율) × 40 +
  (N1/N2 초과시간 / 근무시간) × 30 +
  (비정상 패턴 횟수) × 20 +
  (장시간 공백 횟수) × 10

점수 해석:
- 0-20: 정상 근무
- 21-40: 주의 필요
- 41-60: 비업무 의심
- 61-100: 비업무 확실
```

### 11.5 부서/직무별 보정

|직무 유형|특성|보정 사항|
|---|---|---|
|생산직|정해진 구역 근무|O 태그 비중 높음, T1 빈도 낮음|
|연구직|실험실/사무실 이동|T1 빈도 높음 정상, G3/G4 빈번|
|영업직|외부 미팅 많음|T2 빈도 높음, 외출 패턴 정상|
|관리직|회의 빈번|G3 비중 높음, 이동 많음|

### 11.6 비업무 알림 기준

1. **실시간 알림**:
    - N1 2시간 이상 체류
    - O 태그 3시간 이상 없음
    - 비근무 시간 태그 발생
2. **일일 리포트**:
    - O 태그 비율 30% 미만
    - 비정상 패턴 3회 이상
    - 비업무 점수 40점 이상
3. **주간 분석**:
    - 3일 이상 비업무 패턴 반복
    - 특정 시간대 비업무 집중
    - 부서 평균 대비 이상치