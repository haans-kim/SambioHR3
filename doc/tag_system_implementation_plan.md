# 태그 기반 활동 분류 시스템 구현 계획

## 1. 현재 시스템 분석 결과

### 기존 HMM 시스템 구조
- **17개 상태**: 근무, 집중근무, 장비조작, 회의, 작업준비, 조식, 중식, 석식, 야식, 이동, 출근, 퇴근, 휴식, 피트니스, 비근무, 연차, 출산휴가, 병가, 출장
- **10개 관측값 특성**: 태그위치, 시간간격, 요일, 시간대, 근무구역여부, ABC작업분류, 근태상태, 제외시간여부, CAFETERIA위치, 교대구분
- **복잡한 알고리즘**: Viterbi (상태 예측), Baum-Welch (모델 학습)
- **전이 확률 매트릭스**: 17x17 = 289개의 전이 확률 관리

### 기존 시스템의 문제점
1. 과도한 복잡성으로 인한 유지보수 어려움
2. 실제 현장에서는 명확한 규칙 기반이 더 효과적
3. 전이 확률 조정이 어려움

## 2. 새로운 태그 시스템 설계

### 12개 태그 체계
| 태그 코드 | 설명 | 기존 시스템 매핑 |
|-----------|------|------------------|
| G1 | 주업무 수행 공간 | WORK, FOCUSED_WORK |
| G2 | 작업 전 준비 공간 | WORK_PREPARATION |
| G3 | 회의/협업 공간 | MEETING |
| G4 | 교육 공간 | (신규) |
| N1 | 휴식/외부 공간 | REST, FITNESS |
| N2 | 복지/편의시설 | FITNESS |
| T1 | 복도/계단 등 이동 | MOVEMENT |
| T2 | 1선 출근 지점 | CLOCK_IN |
| T3 | 1선 퇴근 지점 | CLOCK_OUT |
| M1 | 바이오플라자 식사 | BREAKFAST, LUNCH, DINNER, MIDNIGHT_MEAL |
| M2 | 바이오플라자 테이크아웃 | (신규) |
| O | 실제 업무 수행 로그 | EQUIPMENT_OPERATION |

### 11개 상태 정의
1. **업무** - 실제 업무 수행
2. **준비** - 업무 준비/정리
3. **회의** - 회의 및 협업
4. **교육** - 교육 참석
5. **휴게** - 휴식 (식사 제외)
6. **식사** - 식사
7. **경유** - 단순 이동/통과
8. **출입(IN)** - 출근/입실
9. **출입(OUT)** - 퇴근/퇴실
10. **비업무** - 외출 및 기타
11. **업무(확실)** - O 태그가 있는 업무

## 3. 구현 단계별 계획

### Phase 1: 데이터베이스 및 기초 구조 (Task 2, 3)
1. 태그 마스터 테이블 생성
```sql
CREATE TABLE tag_master (
    tag_code VARCHAR(10) PRIMARY KEY,
    tag_name VARCHAR(100),
    tag_category VARCHAR(20), -- G, N, T, M, O
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE
);
```

2. 태그 매핑 테이블
```sql
CREATE TABLE location_tag_mapping (
    location_code VARCHAR(50),
    tag_code VARCHAR(10),
    mapping_confidence FLOAT,
    created_at TIMESTAMP
);
```

3. 상태 전환 규칙 테이블
```sql
CREATE TABLE state_transition_rules (
    from_tag VARCHAR(10),
    to_tag VARCHAR(10),
    state VARCHAR(50),
    probability FLOAT,
    time_condition JSON,
    is_active BOOLEAN DEFAULT TRUE
);
```

### Phase 2: 태그 매핑 로직 (Task 3)
1. 기존 DR_NO, DR_NM을 태그 코드로 매핑
2. ABC 활동 데이터를 O 태그로 변환
3. 시간대와 위치 정보 결합하여 상태 추론

### Phase 3: 상태 분류 엔진 (Task 4, 5, 6, 7)
1. 규칙 기반 분류 엔진 구현
2. 시간대별 가중치 시스템
3. O 태그 특별 처리 로직
4. 전환 확률 매트릭스 (12x12 = 144개로 단순화)

### Phase 4: 이상 패턴 감지 (Task 8, 9)
1. 꼬리물기 감지 개선
2. 장시간 외출 패턴 식별
3. 비업무 점수 산정

### Phase 5: UI 및 통합 (Task 10, 13)
1. 확률 에디터 UI
2. 기존 대시보드 통합
3. 실시간 상태 표시

### Phase 6: 마이그레이션 및 검증 (Task 11, 14)
1. 데이터 마이그레이션 도구
2. A/B 테스트 프레임워크
3. 성능 비교 분석

## 4. 주요 구현 고려사항

### 기존 코드와의 통합 전략
1. **단계적 전환**: HMM과 태그 시스템 병행 운영
2. **인터페이스 유지**: 기존 API 호환성 보장
3. **설정 가능한 전환**: 환경 변수로 시스템 선택

### 성능 최적화 방안
1. 태그 매핑 캐싱
2. 규칙 기반으로 계산 단순화
3. 불필요한 확률 계산 제거

### 데이터 무결성 보장
1. 태그 누락 시 보간 로직
2. 이상 데이터 필터링
3. 검증 메트릭 구현

## 5. 예상 효과

### 정량적 효과
- 분류 정확도: 85% → 90% 이상
- 처리 속도: 50% 향상 (확률 계산 단순화)
- 규칙 수정 시간: 80% 단축

### 정성적 효과
- 현장 관리자가 직접 규칙 수정 가능
- 명확한 분류 근거 제시
- 새로운 패턴 추가 용이

## 6. 리스크 및 대응 방안

### 기술적 리스크
1. **데이터 마이그레이션 오류**: 백업 및 롤백 계획 수립
2. **성능 저하**: 병렬 처리 및 캐싱 강화
3. **호환성 문제**: 어댑터 패턴으로 기존 인터페이스 유지

### 운영적 리스크
1. **사용자 교육**: 단계별 교육 계획 수립
2. **초기 정확도 저하**: A/B 테스트로 점진적 전환
3. **규칙 관리 복잡성**: 규칙 버전 관리 시스템 구축

## 7. 다음 단계

1. 데이터베이스 스키마 상세 설계
2. 태그 매핑 로직 프로토타입 개발
3. 기존 데이터로 POC 진행
4. 성능 및 정확도 비교 분석
5. 단계별 구현 시작