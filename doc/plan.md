# 실근무시간 산정 시스템 구체적 실행계획

## 프로젝트 개요
정원인력 산정을 위한 로그데이터 기반 실근무시간 산정 프로그램

## 1단계: 프로젝트 초기 설정 및 구조 구축 (1-2주)

### 1.1 프로젝트 구조 설정
- [x] 프로젝트 디렉터리 구조 생성
- [x] src/data_processing/ 폴더 및 파일 생성
  - [x] excel_loader.py
  - [x] data_transformer.py
  - [x] pickle_manager.py
- [x] src/database/ 폴더 및 파일 생성
  - [x] schema.py
  - [x] db_manager.py
  - [x] models.py
- [x] src/hmm/ 폴더 및 파일 생성
  - [x] hmm_model.py
  - [x] baum_welch.py
  - [x] viterbi.py
  - [x] rule_editor.py
- [x] src/analysis/ 폴더 및 파일 생성
  - [x] individual_analyzer.py
  - [x] organization_analyzer.py
- [x] src/ui/ 폴더 및 파일 생성
  - [x] streamlit_app.py
  - [x] components/
- [x] data/ 폴더 구조 생성
  - [x] raw/
  - [x] processed/
  - [x] pickles/
- [x] tests/ 폴더 생성
- [x] config/ 폴더 생성

### 1.2 가상환경 및 의존성 설정
- [x] Python 3.9+ 가상환경 생성
- [x] requirements.txt 작성
- [x] pandas>=1.5.0 설치
- [x] numpy>=1.21.0 설치
- [x] sqlite3 설치
- [x] streamlit>=1.25.0 설치
- [x] matplotlib>=3.5.0 설치
- [x] seaborn>=0.11.0 설치
- [x] openpyxl>=3.0.0 설치
- [x] scikit-learn>=1.1.0 설치
- [x] hmmlearn>=0.2.8 설치
- [x] plotly>=5.10.0 설치

## 실제 데이터 구조 분석 (2025년 6월)

### 24시간 2교대 근무 시스템
- [x] 교대 근무 시스템 분석 완료
- [x] 출퇴근 특이사항 파악 (출근일과 퇴근일이 다를 수 있음)
- [x] 4번 식사시간 파악
  - [x] 조식: 06:30-09:00 + CAFETERIA
  - [x] 중식: 11:20-13:20 + CAFETERIA
  - [x] 석식: 17:00-20:00 + CAFETERIA
  - [x] 야식: 23:30-01:00 + CAFETERIA
- [x] 자정 이후 시간 연속성 요구사항 파악

### 데이터 파일 구조 분석
- [x] 1. 태깅 데이터 (tag_data_24.6.xlsx) 분석
- [x] 2. ABC 실제 작업 데이터 (data_ABC데이터 리스트_2506.xlsx) 분석
- [x] 3. 근무시간 Claim 데이터 (data_근무시간(claim)_전사_2506.xlsx) 분석
- [x] 4. 근태 사용 데이터 (data_근태 사용_2506.xlsx) 분석
- [x] 5. 비근무시간 데이터 (data_임직원 비근무시간 raw data_2506.xlsx) 분석
- [x] 6. 인원현황 (25년 6월말 인원현황.xlsx) 분석
- [x] 7. 태깅지점 마스터 (마스터파일_태깅지점_20250718.xlsx) 분석
- [x] 8. 조직 매칭 (조직,인원,R&R matching_250709.xlsx) 분석

## 2단계: 데이터 처리 파이프라인 구축 (2-3주)

### 2.1 엑셀 데이터 로더 구현
- [x] excel_loader.py 기본 구조 구현
- [x] 100MB+ 엑셀 파일 효율적 로딩 기능
- [x] 청크 단위 읽기 및 메모리 최적화
- [x] 데이터 검증 및 오류 처리

### 2.2 데이터 변환 및 전처리
- [x] data_transformer.py 기본 구조 구현
- [x] 태깅데이터 시계열 정렬 로직
- [x] 꼬리물기 현상 처리 알고리즘 구현
- [x] 누락 구간 탐지 및 보간 로직

### 2.3 Pickle 파일 관리
- [x] pickle_manager.py 구현
- [x] 데이터프레임 직렬화/역직렬화
- [x] 버전 관리 및 캐싱 전략

### 2.4 데이터 타입별 처리 로직 (2교대 근무 반영)
- [ ] 태깅데이터 처리 로직
  - [ ] 시계열 정렬 (ENTE_DT + 출입시각)
  - [ ] 교대근무 처리: 자정 이후 → 다음날 시간 연속성 처리
  - [ ] 식사시간 탐지: CAFETERIA 위치 + 시간대 매칭
  - [ ] 꼬리물기 현상 탐지 및 보정
  - [ ] 입문/출문 매칭을 통한 체류시간 계산
  - [ ] 근무구역/비근무구역 분류
- [ ] ABC 실제작업 데이터 처리
  - [ ] Activity 분류별 작업시간 집계
  - [ ] 작업대상별 소요시간 분석
  - [ ] 태깅데이터와 시간 구간 매칭
- [ ] 근무시간 Claim 데이터 처리 (24시간 근무 반영)
  - [ ] 교대근무 처리: 출근일 ≠ 퇴근일 경우 시간 연속성 처리
  - [ ] 개인 신고시간 vs 실제 근무시간 비교
  - [ ] 근태코드별 시간 분류
- [ ] 근태 사용 데이터 처리
  - [ ] 연차, 출장 등 공식 비근무 시간 식별
  - [ ] 근태사유별 시간 집계
- [ ] 비근무시간 데이터 처리
  - [ ] 4번 식사시간: 조식/중식/석식/야식 시간대별 식별
  - [ ] 점심시간, 교육시간 등 제외시간 처리
  - [ ] 제외시간구분별 분류
- [ ] 조직 마스터 데이터 처리
  - [ ] 센터-BU-팀-그룹-파트 계층구조 파싱
  - [ ] 사번-조직 매핑 테이블 생성

## 3단계: 데이터베이스 설계 및 구현 (1-2주)

### 3.1 SQLite 데이터베이스 스키마 설계
- [x] daily_work_data 테이블 설계 (2교대 근무 반영)
- [x] shift_work_data 테이블 설계 (교대근무 시간 데이터)
- [x] organization_summary 테이블 설계
- [x] tag_logs 테이블 설계
- [x] abc_activity_data 테이블 설계 (ABC 작업 데이터)
- [x] claim_data 테이블 설계 (근무시간 Claim 데이터)
- [x] attendance_data 테이블 설계 (근태 사용 데이터)
- [x] non_work_time_data 테이블 설계 (비근무시간 데이터)
- [x] employee_info 테이블 설계 (직원 정보)
- [x] tag_location_master 테이블 설계 (태깅 지점 마스터)
- [x] organization_mapping 테이블 설계 (조직 매칭)
- [x] hmm_model_config 테이블 설계 (HMM 모델 설정)
- [x] processing_log 테이블 설계 (처리 로그)

### 3.2 데이터베이스 매니저 구현
- [x] db_manager.py 구현
- [x] 연결 관리 및 쿼리 실행
- [x] 트랜잭션 처리 및 오류 복구
- [x] 대용량 데이터 배치 처리

## 4단계: HMM 모델 구현 (3-4주)

### 4.1 HMM 모델 기본 구조
- [x] hmm_model.py 기본 구조 구현
- [x] 상태 정의 (2교대 근무 반영)
  - [x] 근무상태: 근무, 집중근무, 장비조작, 회의, 작업준비, 작업중
  - [x] 식사상태: 조식, 중식, 석식, 야식 (시간대별 구분)
  - [x] 이동상태: 이동, 출근, 퇴근
  - [x] 휴식상태: 휴식, 피트니스
  - [x] 비근무상태: 연차, 배우자출산
- [x] 관측값 정의 (24시간 근무 반영)
  - [x] 태그 위치 (DR_NO, DR_NM 기반)
  - [x] 시간 간격 (출입시각 차이)
  - [x] 요일 (DAY_NM)
  - [x] 시간대 (출입시각을 시간 구간으로 변환, 자정 이후 처리)
  - [x] 근무구역 여부 (마스터파일 기반)
  - [x] ABC 작업 데이터 (Activity 분류)
  - [x] 근태 상태 (근태코드)
  - [x] 제외시간 여부 (비근무시간 데이터 기반)
  - [x] CAFETERIA 위치 + 시간대 → 식사상태 식별
  - [x] 교대근무자 식별 (야간근무자 시간 처리)

### 4.2 전이 규칙 (Transition Rules) 정의
- [x] 상태 간 전이 확률 매트릭스 구현
- [x] 시간대별 전이 확률 조정
- [x] 개인별/조직별 전이 패턴 학습

### 4.3 방출 규칙 (Emission Rules) 정의
- [x] 각 상태별 태그 위치 확률 구현
- [x] 시간 간격별 방출 확률
- [x] 다차원 관측값 처리

### 4.4 Baum-Welch 학습 알고리즘 구현
- [x] baum_welch.py 구현
- [x] 파라미터 최적화
- [x] 수렴 조건 설정 및 성능 모니터링
- [x] 정규화 및 수치 안정성 확보

### 4.5 Viterbi 예측 알고리즘 구현
- [x] viterbi.py 구현
- [x] 최적 상태 시퀀스 추정
- [x] 로그 확률 계산으로 언더플로우 방지
- [x] 실시간 예측 성능 최적화

### 4.6 규칙 에디터 구현
- [x] rule_editor.py 구현
- [x] 전이/방출 규칙 수정 인터페이스
- [x] 규칙 검증 및 일관성 검사
- [x] 규칙 버전 관리

## 5단계: 분석 엔진 구현 (2-3주)

### 5.1 개인별 분석기 (2교대 근무 반영)
- [ ] individual_analyzer.py 구현
- [ ] HMM 모델 적용 (24시간 근무 반영)
  - [ ] 태깅 시계열 → 상태 시퀀스 변환
  - [ ] 교대근무 처리: 자정 이후 시간 연속성 처리
  - [ ] 식사시간 자동 인식: CAFETERIA + 시간대 매칭
  - [ ] ABC 작업 데이터와 상태 매칭
  - [ ] 제외시간 반영한 실근무시간 계산
- [ ] 분석 지표 (2교대 근무 특화)
  - [ ] 실근무시간 vs Claim 시간 비교 (근무시간 차이율)
  - [ ] 상태별 시간 분포 (근무/휴식/이동/식사 등)
  - [ ] 식사시간 분석: 조식/중식/석식/야식 시간 추적
  - [ ] 교대별 근무 효율: 주간/야간 교대 비교 분석
  - [ ] 작업 효율성 지표 (집중근무 비율)
  - [ ] 근태 정확도 (신고시간 vs 실제시간)
  - [ ] 시간 연속성 처리: 출근일 ≠ 퇴근일 경우 올바른 근무시간 계산

### 5.2 조직별 분석기
- [ ] organization_analyzer.py 구현
- [ ] 평균 근무시간 및 가동율 계산
- [ ] 조직 간 비교 분석

### 5.3 배치 처리 시스템
- [ ] 대용량 데이터 처리를 위한 배치 작업
- [ ] 진행률 모니터링 및 오류 처리
- [ ] 병렬 처리 및 성능 최적화

## 6단계: UI 개발 (2-3주)

### 6.1 Streamlit 기반 초기 UI (참조자료 반영)
- [ ] streamlit_app.py 메인 애플리케이션 구현
- [ ] 사이드바 네비게이션 구성
  - [ ] 일일 활동 요약
  - [ ] 활동 타임라인
  - [ ] 주간/월간 요약
  - [ ] 조직별 비교
- [ ] 데이터 업로드 및 처리 인터페이스
  - [ ] 엑셀 파일 업로드
  - [ ] 실시간 처리 진행률 표시
  - [ ] 오류 로그 및 경고 메시지

### 6.2 대시보드 화면 (참조자료 반영)
- [ ] 주요 KPI 대시보드
  - [ ] Claim 시간 vs 실제 업무시간 비교
  - [ ] 업무 효율성 비율
  - [ ] 데이터 신뢰도 지표
- [ ] 시각화 차트
  - [ ] 색상별 활동 분류 차트
  - [ ] 시간대별 활동 히트맵
  - [ ] 프로그레스 바 스타일 비교 차트
- [ ] 필터링 및 드릴다운 기능
  - [ ] 조직별/직급별 필터
  - [ ] 날짜 범위 선택
  - [ ] 활동 유형별 표시/숨기기

### 6.3 개인 상세 화면 (UI 참조자료 반영)

#### A. 일일 활동 요약 (상단 섹션)
- [ ] 주요 지표 대시보드
  - [ ] Claim 시간 vs 실제 업무시간 비교
  - [ ] 업무 효율성 비율 (89.5% 예시)
  - [ ] 시각적 프로그레스 바로 비교 표시
- [ ] 활동 분류별 시간 분포
  - [ ] 작업시간: 6.5h (76.5%)
  - [ ] 회의시간: 1.2h (14.1%)
  - [ ] 이동시간: 0.8h (9.4%)
  - [ ] 데이터 신뢰도: 85% (추정 포함)
- [ ] 세부 시간 정보
  - [ ] 비업무시간, 접촉시간, 휴게시간, 개인활동 별도 표시

#### B. 활동 타임라인 (하단 섹션)
- [ ] 시간축 시각화
  - [ ] 24시간 타임라인 (2교대 근무 반영)
  - [ ] 자정 이후 시간 연속성 처리
- [ ] 태깅 포인트 시각화
  - [ ] 각 태깅 시점별 위치와 시간 표시
  - [ ] 색상별 활동 분류 (작업실, 회의실, 이동, 휴게 등)
  - [ ] 신뢰도 표시: 실제 태깅(100%) vs 추정 데이터
- [ ] 식사시간 표시
  - [ ] 조식/중식/석식/야식 시간대 강조
  - [ ] CAFETERIA 위치 태깅 특별 표시

#### C. 데이터 신뢰도 시각화
- [ ] 실제 태깅 데이터: 파란색 원형 (100% 신뢰도)
- [ ] 추정 데이터: 연한 색상 원형 (신뢰도 표시)
- [ ] 데이터 품질 지표: 전체 데이터 신뢰도 퍼센테이지

#### D. 인터랙션 기능
- [ ] 시간대 확대/축소: 상세 분석을 위한 줌 기능
- [ ] 활동 필터링: 특정 활동 유형별 표시/숨기기
- [ ] 데이터 드릴다운: 특정 시간 구간 상세 정보 표시
- [ ] 비교 모드: 여러 날짜 비교 분석

### 6.4 HMM 규칙 편집 화면 (참조자료 연동)
- [ ] 전이 규칙 매트릭스 편집기
  - [ ] 시각적 매트릭스 편집기
  - [ ] 활동 분류 간 전이 확률 설정
  - [ ] 실시간 미리보기 기능
- [ ] 방출 규칙 편집기
  - [ ] 태깅 위치별 활동 분류 매핑
  - [ ] 시간대별 활동 확률 설정
  - [ ] 식사시간 자동 인식 규칙
- [ ] 규칙 시각화 및 검증
  - [ ] 활동 타임라인 시뮬레이션
  - [ ] 예측 결과 실제 데이터 비교
  - [ ] 정확도 지표 실시간 모니터링

### 6.5 설정 및 관리 화면 (참조자료 반영)
- [ ] 데이터 소스 관리
  - [ ] 엑셀 파일 업로드 히스토리
  - [ ] 데이터 품질 지표 대시보드
  - [ ] 실시간 데이터 업데이트 상태
- [ ] 모델 파라미터 설정
  - [ ] HMM 모델 파라미터 조정
  - [ ] 신뢰도 임계값 설정
  - [ ] 활동 분류 계층 구조 설정
- [ ] 배치 작업 모니터링
  - [ ] 실시간 처리 진행률
  - [ ] 오류 로그 및 경고 메시지
  - [ ] 시스템 성능 지표

## 7단계: 테스트 및 검증 (1-2주)

### 7.1 단위 테스트
- [ ] 각 모듈별 테스트 케이스 작성
- [ ] 데이터 처리 로직 검증
- [ ] HMM 알고리즘 정확성 테스트

### 7.2 통합 테스트
- [ ] 전체 파이프라인 동작 검증
- [ ] 대용량 데이터 처리 성능 테스트
- [ ] UI 사용성 테스트

### 7.3 데이터 검증
- [ ] 실제 데이터 기반 모델 성능 평가
- [ ] 분석 결과 정확성 검증
- [ ] 도메인 전문가 리뷰

## 8단계: 배포 및 운영 (1주)

### 8.1 배포 환경 설정
- [ ] 프로덕션 환경 구성
- [ ] 데이터베이스 백업 및 복구 전략
- [ ] 모니터링 및 로깅 시스템

### 8.2 사용자 교육
- [ ] 사용자 매뉴얼 작성
- [ ] 교육 자료 준비
- [ ] 피드백 수집 체계 구축

## 9단계: 고도화 계획 (장기)

### 9.1 React/TSX 기반 웹 UI
- [ ] 현재 Streamlit UI를 React로 전환
- [ ] shadcn UI 컴포넌트 적용
- [ ] RESTful API 설계 및 구현

### 9.2 머신러닝 모델 고도화
- [ ] 딥러닝 모델 적용 검토
- [ ] 앙상블 모델 구현
- [ ] 자동 하이퍼파라미터 튜닝

### 9.3 실시간 처리 시스템
- [ ] 실시간 태그 데이터 처리
- [ ] 스트리밍 분석 파이프라인
- [ ] 알림 및 예외 처리 시스템

## 성공 지표 및 KPI (2교대 근무 반영)

- [ ] **데이터 처리 성능**: 100MB+ 엑셀 파일 10분 이내 처리
- [ ] **HMM 모델 정확도**: 90% 이상의 상태 분류 정확도
- [ ] **2교대 근무 처리 정확도**: 95% 이상의 자정 이후 시간 연속성 처리
- [ ] **식사시간 인식 정확도**: 90% 이상의 4번 식사시간 자동 인식
- [ ] **시스템 응답 속도**: 대시보드 로딩 3초 이내 (24시간 데이터 처리 포함)
- [ ] **사용자 만족도**: 사용성 테스트 4.0/5.0 이상
- [ ] **데이터 품질**: 99% 이상의 데이터 무결성 보장
- [ ] **교대근무 분석 정확도**: 주간/야간 교대 근무 효율 비교 정확도 85% 이상

## 리스크 관리

- [ ] **데이터 품질 리스크**: 데이터 검증 로직 강화
- [ ] **성능 리스크**: 병렬 처리 및 캐싱 전략
- [ ] **모델 정확도 리스크**: 도메인 전문가 협력
- [ ] **기술 리스크**: 프로토타입 기반 검증
- [ ] **일정 리스크**: 단계별 마일스톤 관리

## 2교대 근무 시스템 추가 고려사항

### 기술적 고려사항
- [ ] **시간 연속성 처리**: 자정 이후 시간 연속성 알고리즘
- [ ] **식사시간 자동 인식**: CAFETERIA 위치 + 시간대 매칭 로직
- [ ] **교대근무 분류**: 주간/야간 교대 자동 식별
- [ ] **데이터베이스 스키마**: 교대근무 정보 및 식사시간 추가

### 비즈니스 요구사항
- [ ] **교대별 근무 효율 비교**: 주간/야간 교대 성과 비교 분석
- [ ] **4번 식사시간 추적**: 조식/중식/석식/야식 시간 개별 추적
- [ ] **교대근무 규정 준수**: 자정 이후 근무 규정 준수 여부 확인
- [ ] **식사시간 최적화**: 식사시간 활용 효율성 분석

### 추가 개발 사항
- [ ] **교대근무 스케줄링**: 최적 교대 배치 알고리즘
- [ ] **식사시간 예측**: 개인별 식사시간 패턴 분석 및 예측
- [ ] **교대별 업무 분류**: 주간/야간 교대에 적합한 업무 분류
- [ ] **대시간 연속성 분석**: 교대 바뀌는 시점의 업무 연속성 분석

## 예상 일정

총 소요 기간: **14-18주** (2교대 근무 반영으로 2주 추가)
- 1-4단계: 7-9주 (기반 구축 + 2교대 근무 반영)
- 5-6단계: 4-6주 (핵심 기능 + 교대근무 분석)
- 7-9단계: 3-3주 (완성도 제고 + 2교대 근무 특화 기능)